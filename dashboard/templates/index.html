<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>APRT Trigger Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>
    <header class="topbar reveal">
      <div class="brand">
        <p class="kicker">APRT PHASE 5</p>
        <h1>Trigger Control Grid</h1>
      </div>
      <div class="actions">
        <button id="refreshBtn" class="btn btn-muted">Refresh</button>
      </div>
    </header>

    <nav class="viewbar reveal">
      <span class="pill active">Runs Table</span>
      <span class="pill">Trigger Queue</span>
      <span class="pill">Script Pane</span>
    </nav>

    <main class="layout">
      <section class="panel panel-triggers reveal">
        <div class="panel-head">
          <h2>Trigger Launcher</h2>
          <p>Start dry or live runs from this dashboard.</p>
        </div>

        <form id="triggerForm" class="trigger-form">
          <label>
            Mode
            <select id="modeSelect">
              <option value="dry">Dry Run</option>
              <option value="live">Live Run</option>
            </select>
          </label>
          <label>
            Provider
            <select id="providerSelect">
              <option value="auto">Auto (Supabase -> Cloudinary)</option>
              <option value="supabase">Supabase Only</option>
              <option value="cloudinary">Cloudinary Only</option>
            </select>
          </label>
          <button type="submit" class="btn btn-primary">Launch Trigger</button>
        </form>

        <div class="trigger-meta">
          <h3>Configured Triggers</h3>
          <div id="triggerInfo" class="trigger-info"></div>
        </div>
      </section>

      <section class="panel panel-runs reveal">
        <div class="panel-head">
          <h2>Runs (Airtable View)</h2>
          <p>Latest payload runs and cloud transfer outcomes.</p>
        </div>
        <div class="table-wrap">
          <table id="runsTable">
            <thead>
              <tr>
                <th>Run ID</th>
                <th>Status</th>
                <th>Scenes</th>
                <th>Cloud</th>
                <th>Started (UTC)</th>
                <th>Ended (UTC)</th>
                <th>Destination</th>
              </tr>
            </thead>
            <tbody id="runsBody"></tbody>
          </table>
        </div>
      </section>

      <section class="panel panel-jobs reveal">
        <div class="panel-head">
          <h2>Trigger Queue</h2>
          <p>Background trigger job history and log tail.</p>
        </div>
        <div class="jobs-wrap">
          <table id="jobsTable">
            <thead>
              <tr>
                <th>Job ID</th>
                <th>Mode</th>
                <th>Provider</th>
                <th>Status</th>
                <th>Requested (UTC)</th>
                <th>Finished (UTC)</th>
              </tr>
            </thead>
            <tbody id="jobsBody"></tbody>
          </table>
        </div>
        <div class="log-pane">
          <h3>Selected Job Log</h3>
          <pre id="jobLog"></pre>
        </div>
      </section>

      <section class="panel panel-script reveal">
        <div class="panel-head">
          <h2>Script Viewer</h2>
          <p id="scriptPath">Loading script path...</p>
        </div>
        <pre id="scriptText" class="script-text"></pre>
      </section>
    </main>

    <div id="toast" class="toast"></div>
    <script src="/static/app.js"></script>
  </body>
</html>
